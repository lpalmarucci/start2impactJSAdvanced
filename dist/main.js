(()=>{const e=document.getElementById("search-box"),t=document.getElementById("search-img"),n=document.getElementById("gps-img"),o=document.getElementById("loader"),a=document.getElementById("clear-searchbox"),r={good:{interval:{from:0,to:50},color:"green"},moderate:{interval:{from:51,to:100},color:"yellow"},unhealthy_for_sensitive_groups:{interval:{from:101,to:150},color:"orange"},unhealthy:{interval:{from:151,to:200},color:"red"},very_unhealthy:{interval:{from:201,to:300},color:"purple"},hazardous:{interval:{from:300,to:null},color:"darkred"}};class l extends Error{constructor(e){super(e),this.name="ResponseError",this.message=`[Error] ${e}`}}function d(t){o.show("block"),function(t){return new Promise(((e,t)=>{navigator.geolocation.getCurrentPosition((t=>{e(t.coords)}))})).then((({latitude:n,longitude:o})=>t?fetch(`https://api.waqi.info/feed/geo:${n};${o}/?token=a2ef6934b6a41dc2345540701548d8a539da7cb9`):fetch(`https://api.waqi.info/feed/${e.value.toLowerCase()}/?token=a2ef6934b6a41dc2345540701548d8a539da7cb9`)))}(t).then((e=>(o.hide(),document.querySelector("#data-container").show("flex"),e.json()))).then((e=>{if("ok"!=e.status)throw new l(e.data);!function(e){(function(e){let t,n=document.querySelector("#aiq-info > .title > b"),o=Object.assign({},{text:e});if("-"!=e){for(t in r){let{interval:o,color:a}=r[t];if(e>=o.from&&e<=o.to){n.style.color=a;break}}t=t.replace("_"," ").toUpperCase()}else text_no_available="No level available",n.style.color="grey";n.innerText="-"!=e?o.text+` (${t})`:text_no_available})(e.aqi),document.querySelector(".table-data > tbody")?.remove(),document.querySelector(".data-title-info")?.remove(),document.getElementById("aiq-info").show("flex");let t=document.createElement("span");t.className="data-title-info",t.innerHTML=`Information about <b>${e.city.name}</b>`,document.getElementById("data-container").insertAdjacentElement("afterbegin",t),function(e){let t=document.createElement("tbody");for(let n in e.iaqi){let o=document.createElement("tr"),a=c("td",n.toUpperCase());o.append(a),a=c("td",e.iaqi[n].v),o.append(a),t.append(o)}document.querySelector(".table-data").append(t)}(e),""!=e.time.s?i(new Date(e.time.s)):i("");let n=document.getElementById("forecast-section"),o=document.querySelector(".title-section > span");for(o.className="title",o.style.fontWeight="bold";n.firstChild;)n.firstChild.remove();e.forecast?.daily&&Object.keys(e.forecast.daily).length>0?(o.innerText="Forecast",document.getElementById("forecast").show("flex"),function(e){let t=document.getElementById("forecast-section");for(let n in e){let o=document.createElement("div");o.classList.add("forecast-subsection");let a=document.createElement("h3");a.innerText=n.toUpperCase(),o.append(a),t.append(o);let r=document.createElement("div");r.className="forecast-wrapper";let l=document.createElement("table");l.className="single-forecast";let d=document.createElement("thead"),i=document.createElement("tr"),s=c("th","Date");i.append(s),s=c("th","Min"),i.append(s),s=c("th","Max"),i.append(s),d.append(i),l.append(d);let m=document.createElement("tbody");for(let{min:t,max:o,day:a}of e[n]){let e=document.createElement("tr"),n=new Date(a),r=(n.toString(),c("td",n));e.append(r),r=c("td",`${t}`),e.append(r),r=c("td",`${o}`),e.append(r),m.append(e)}l.append(m),r.append(l),o.append(r)}}(e.forecast.daily)):o.innerText="No forecast available"}(e.data)})).catch((e=>{o.hide(),document.getElementById("data-container").hide(),document.getElementById("forecast").hide(),document.getElementById("aiq-info").hide(),function(e){alertShowInPage=!0;let t=document.createElement("footer");t.setAttribute("id","alert");let n=document.createElement("span");n.textContent=e,n.classList.add("text-alert"),t.append(n);let o=document.createElement("div");o.className="line",t.append(o),document.getElementById("head-section").append(t);let a=t.getBoundingClientRect();t.style.position="absolute",t.style.top=window.innerHeight-a.height-10+"px",t.style.left=(window.innerWidth-a.width)/2+"px";let r=new CustomEvent("timerExpired");o.addEventListener("timerExpired",(()=>{document.getElementById("alert").style.opacity=0,clearInterval(interval),alertShowInPage=!1,setTimeout((()=>document.getElementById("alert").remove()),400)}));let l=setInterval((()=>{let e=o.getBoundingClientRect().width;e-1==0&&(interval=l,o.dispatchEvent(r)),o.style.width=e-1+"px"}),6)}(e.message)}))}function i(e){document.querySelector(".updated-at")?.remove();let t,n=document.createElement("span");n.classList.add("updated-at");try{let o=e.getMonth();o=o<10?`0${o}`:o;let a=e.getDate();a=a<10?`0${a}`:a;let r=e.getHours();r=r<10?`0${r}`:r;let l=e.getMinutes();l=l<10?`0${l}`:l,t=`Last update at ${e.toString()}`}catch(e){t="There isn't a time"}finally{n.innerText=t,document.getElementById("data-container").insertAdjacentElement("beforeend",n)}}function c(e,t){let n=document.createElement(e);return n.innerText=t,n}Element.prototype.hide=function(){this.style.display="none"},Element.prototype.show=function(e){this.style.display=e},Date.prototype.toString=function(){let e=this.getDate(),t=this.getMonth(),n=this.getHours(),o=this.getMinutes();return t=t<10?`0${t}`:t,e=e<10?`0${e}`:e,n=n<10?`0${n}`:n,o=o<10?`0${o}`:o,`${this.getFullYear()}/${t}/${e} ${n}:${o}`},document.querySelector("#data-container").hide(),document.getElementById("aiq-info").hide(),document.addEventListener("DOMContentLoaded",(()=>{e.focus(),document.querySelector("form").addEventListener("submit",d),t.addEventListener("click",(()=>{""!==e.value?d():function(){e.focus(),e.classList.add("search-box-error");let t=document.querySelector(".search-box-error-message");t.style.display="inline-block",t.style.opacity=1}()})),n.addEventListener("click",(e=>{d(!0)})),a.addEventListener("click",(()=>{e.value=""}))})),e.addEventListener("keydown",(t=>{let n=t.code.toLowerCase();(-1===n.indexOf("key")&&"space"!=n&&"backspace"!=n&&"tab"!=n||"enter"==n)&&t.preventDefault(),setTimeout((()=>{if(""!=t.target.value)if(t.target.classList.contains("search-box-error")&&(document.querySelector(".search-box-error-message").style.opacity=0,e.classList.remove("search-box-error")),document.querySelector(".error-container")){let e=document.querySelector(".error-container");e.style.opacity=0,setTimeout((()=>e.remove()),1e3)}else"enter"===n&&d()}),1)}))})();